<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>League Champions</title>
    <link rel="stylesheet" href="css/style-main.css">
</head>
<body>
    <h1>League Champions and Cocktails</h1>
    <div class="container" id="championContainer"></div>

    <div id="transitionOverlay"></div>

    <script>
        async function fetchChampions() {
            const res = await fetch("/api/champions");
            const champions = await res.json();
            const container = document.getElementById("championContainer");

            champions.forEach(champ => {
                const champDiv = document.createElement("div");
                champDiv.classList.add("champion");
                champDiv.innerHTML = `
                    <div class="image-container" style="border-color:${champ.Mixed};">
                        <img src="${champ.Image}" alt="${champ.Name}">
                    </div>
                    <h3 style="color: ${champ.Mixed};">${champ.Name}</h3>
                    <h5 style="color: ${champ.Mixed};">${champ["Cocktail Name"]}</h5>
                    <div class="palette">
                        ${champ.Palette.map(color => `<div class="color-box" style="background:${color};"></div>`).join("")}
                    </div>
                    <div class="ingredients-list" id="ingredients-${champ.Name}">
                        ${champ.Ingredients.map(ingredient => `
                            <div class="ingredient-item">
                                ${ingredient}
                            </div>
                        `).join("")}
                    </div>
                `;

                champDiv.addEventListener("click", (e) => {
                    const overlay = document.getElementById("transitionOverlay");

                    const x = e.clientX;
                    const y = e.clientY;

                    overlay.style.background = champ.Mixed;
                    overlay.style.top = `${y}px`;
                    overlay.style.left = `${x}px`;
                    overlay.style.width = "100px";
                    overlay.style.height = "100px";
                    overlay.style.transform = "translate(-50%, -50%) scale(0)";
                    overlay.style.transition = "none";

                    requestAnimationFrame(() => {
                        overlay.style.transition = "transform 0.7s cubic-bezier(0.4, 0, 0.2, 1)";
                        overlay.style.transform = "translate(-50%, -50%) scale(40)";
                    });
                
                    setTimeout(() => {
                        window.location.href = `/view/${encodeURIComponent(champ.Name)}`;
                    }, 700);
                });


                window.addEventListener("pageshow", () => {
                    const overlay = document.getElementById("transitionOverlay");
                    overlay.style.transition = "none";
                    overlay.style.transform = "translate(-50%, -50%) scale(0)";
                });

                container.appendChild(champDiv);
            });
        }

        async function fetchCocktailsForChampion(championName) {
            const res = await fetch(`/api/cocktails?champion=${championName}`);
            const cocktails = await res.json();
            const cocktailContainer = document.getElementById(`cocktails-${championName}`);

            cocktails.forEach(cocktail => {
                const cocktailDiv = document.createElement("div");
                cocktailDiv.classList.add("cocktail");
                cocktailDiv.innerHTML = `
                    <h5>${cocktail.Name}</h5>
                    <div class="image-container">
                        <img src="${cocktail.Image}" alt="${cocktail.Name}">
                    </div>
                    <p>${cocktail.Description}</p>
                `;
                cocktailContainer.appendChild(cocktailDiv);
            });
        }

        fetchChampions();
    </script>
</body>
</html>
